# Прошивка МК через порт UART

Прошивка чипа посредством программатора, зашитого в сам этот чип (bootloader область flash памяти).

**Плюсы:**

 - Быстрый программатор
 - Все платы ARDUINO с USB разъемом готовы к работе прямо из коробки (классно для новичков)
 - дешевые USB-to-TTL переходники (FTDI, CH430, CP2102, PL2303), позволяющие быстро подключить и прошить ARDUINO pro mini (те, что без USB порта)

**Минусы**

 - UART занят. Если изделию для работы нужен этот порт, то нужно извращаться с переключателями (отрубать порт RX от внешнего устройства на время прошивки)
 - внутренний программатор отъедает память flash - почти килобайт становится недоступным
 - новый чип требует предварительной прошивки программатора (например через SPI)
 - нет возможности тонкой настройки чипа - прошивки фьюзов (например, защита от чтения прошивки)

-----------
# Прошивка МК через порт SPI
Прошивка специальным внешним (или гибридным) программатором, подключаясь к пинам SPI порта чипа.

**Плюсы**

 - Можно прошивать прямо в устройстве (In-System-Programming)
 - Можно прочитать\изменить фьюзы
 - Можно прошить "нулевый" (только с завода) чип
 - Можно восстановить "убитый" ARDUINO чип (если программатор внутри слетел)
 - для программирования чипа доступна вся его память (не тратим байтики на программатор внутри чипа)

**Минусы**

 - Нужно делать на плате устройства 6 пиновый разъем
 - нужен отдельный (внешний) программатор


### (SPI) программатор USBasp

#### Принцип действия
Проект под целевой (target) микроконтроллер (МК) пишется, собирается на хост машине (Windows, Linux, MacOS). Затем готовый hex файл с помощью программы avrdude, запускаемой на хост машине, по интерфейсу USB передается на устройство USBasp, где обрабатывается микроконтроллером устройства (программа - программатор, прошитая в МК) и по интерфейсу SPI прошивается на целевой МК.

#### Изображение

#### Характеристики

|Характерисика | Описание     |
|--------------:|:--------------|
| Мозги устройства    | МК ATMEGA8 или подобный
| Вход (порт на комп) | USB порт
| Windows driver| USB для Win7: libusb-win32 v1.2.6
| Выход (порт на целевой чип) | Стандарт ICSP 10 пин
| Производитель | http://www.fischl.de/usbasp/
| Версия прошивки | последняя: usbasp.2011-05-28 <br> *Требуется прошивка МК, т.к. китайты поставляют старую прошивку, которая может выдавать ошибки\предупреждения!*
| Где купить | [пример на ALIEXPRESS за 1.5 USD]( https://ru.aliexpress.com/item/1pcs-New-USBASP-USBISP-AVR-Programmer-USB-ISP-USB-ASP-ATMEGA8-ATMEGA128-Support-Win7-64K/32653187143.html?spm=a2g0s.9042311.0.0.NNvfPE)
| Обзоры| [Неплохой обзор на Микроконтроллер.ру](http://microkontroller.ru/programmirovanie-mikrokontrollerov-avr/usbasp-usb-avr-programmator/)
| Программа для прошивки | avrdude ver6.3 = OK<br> avrdude ver6.0 = NOK ()
| Особенности | не использовать параметр -D (отмена очистки памяти перед прошивкой) - будут глюки

#### Тесты
